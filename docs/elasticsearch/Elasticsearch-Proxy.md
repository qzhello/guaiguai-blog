---
title: ES代理
# 禁用目录
toc: true
comments: true
weight: 1
---


# ES代理
1. 索引、查询模版熔断、限流（sentinel） 
2. 动态参数配置、动态线程池（写入）。 
3. 批量写入。rocketmq、kafka异步数据消费。 
   压缩。索引、集群纬度数据压缩。 
   动态线程池。流量保护，超出阈值投mq。mq挂掉写本地or丢弃。
   查询内存监控。
4. 优化配置项。
    - timeout设置
    - 本地查询缓存
    - 查询缓存参数
    - size限制
    - wildcard限制
    - 快速失败，防止故障时难以恢复
5. 就近写入，防止data节点之间发送。 
6. 双中心。保证主从数据的最终一致性。数据读写分离，索引/模版级别。结构check。
7. 可观测性。监控与告警。提供标准/metrics，接入prometheus，带上ident，环境，自定义标签。
8. 提供健康接口。/health自检，高负载时，外部心跳或者内部上报数据异常时，可以根据网关规则剔除。
9. 流量录制，可在任何一个集群回放。考虑回放的范围，风险等级。指标：异常，数据一致等。
10. 管控。 
    分片迁移。结合cerebro。  
    慢查询监控，task管理。
    mapping对比。settings修改。
11. 别名，无缝替换索引
12. 迁移服务。可以同步到mysql等。
13. 远程remote 分词库
14. 备份。s3快照，恢复。



9999. AI-LLM 

https://mp.weixin.qq.com/s/A0x--BEbfphrVVD9Twnfgw 

系统接收到新增报警后，可以将报警统一输入到AI算法中，通过AI算法完成报警事件的分拣、分析、判断和关联，完成事故的自动创建、报警自动关联、初因定位定界、相关人员拉群等动作，实现事故应急发起的全套流程智能化，大大减少了值班人员的人工操作内容，同时提升了操作效率。同时，以事故所关联的监控信息、群聊信息、系统元数据信息作为输入，对事故的影响面、处理进展、当前状态完成智能化总结，用于事故进展的主动推送、自助问答，提升事故处理中信息整合与同步的效率。

# 元数据服务
proxy本身不依赖mysql，而是依赖此元数据服务。

元数据服务本身的下游需要依赖双中心的持久化存储。  

业务数据服务分级。更好的做一些参数适配，比如双中心、timeout、缓存时长、写入的refresh时长等。 


# 搬迁服务
1. 跨集群快速迁移。根据集群的健康情况来动态调整迁移速度。
2. 历史数据按条件同步数据。
3. 支持mysql->es。kafka到es。

# 可观测服务
1. 指标。集群、索引、task、io、网络、元数据。

# 压测服务